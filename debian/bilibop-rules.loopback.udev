# Only applies on loop devices:
KERNEL!="loop?*", GOTO="loopback_end"

# Skip loop-control:
SUBSYSTEM!="block", GOTO="loopback_end"

# loop devices always exist, even when they are not associated; so we must have
# a look on their changes:
OPTIONS+="watch"

# This can become useful:
ACTION=="change", \
	TEST=="%S/block/%k/loop/backing_file", \
	PROGRAM=="/bin/cat %S/block/%k/loop/backing_file", \
	ENV{BACKING_FILE}="%c"

LABEL="loopback_end"
